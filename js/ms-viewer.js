pages = [
    {
        "src": "00000001.jpg",
        "n": "front cover",
        "o": "r"
    },
    {
        "src": "00000002.jpg",
        "n": "inside front cover",
        "o": "v"
    },
    {
        "src": "00000003.jpg",
        "n": "1a",
        "o": "r"
    },
    {
        "src": "00000004.jpg",
        "n": "2a",
        "o": "v"
    },
    {
        "src": "00000005.jpg",
        "n": "3a",
        "o": "r"
    },
    {
        "src": "00000006.jpg",
        "n": "4a",
        "o": "v"
    },
    {
        "src": "00000007.jpg",
        "n": "5a",
        "o": "r"
    },
    {
        "src": "00000008.jpg",
        "n": "6a",
        "o": "v"
    },
    {
        "src": "00000009.jpg",
        "n": "7a",
        "o": "r"
    },
    {
        "src": "00000010.jpg",
        "n": "8a",
        "o": "v"
    },
    {
        "src": "00000011.jpg",
        "n": "9a",
        "o": "r"
    },
    {
        "src": "00000012.jpg",
        "n": "10a",
        "o": "v"
    },
    {
        "src": "00000013.jpg",
        "n": "11a",
        "o": "r"
    },
    {
        "src": "00000014.jpg",
        "n": "12a",
        "o": "v"
    },
    {
        "src": "00000015.jpg",
        "n": "13a",
        "o": "r"
    },
    {
        "src": "00000016.jpg",
        "n": "14a",
        "o": "v"
    },
    {
        "src": "00000017.jpg",
        "n": "15a",
        "o": "r"
    },
    {
        "src": "00000018.jpg",
        "n": "16a",
        "o": "v"
    },
    {
        "src": "00000019.jpg",
        "n": "17a",
        "o": "r"
    },
    {
        "src": "00000020.jpg",
        "n": "18a",
        "o": "v"
    },
    {
        "src": "00000021.jpg",
        "n": "19a",
        "o": "r"
    },
    {
        "src": "00000022.jpg",
        "n": "20a",
        "o": "v"
    },
    {
        "src": "00000023.jpg",
        "n": "21a",
        "o": "r"
    },
    {
        "src": "00000024.jpg",
        "n": "22a",
        "o": "v"
    },
    {
        "src": "00000025.jpg",
        "n": "23a",
        "o": "r"
    },
    {
        "src": "00000026.jpg",
        "n": "24a",
        "o": "v"
    },
    {
        "src": "00000027.jpg",
        "n": "25a",
        "o": "r"
    },
    {
        "src": "00000028.jpg",
        "n": "26a",
        "o": "v"
    },
    {
        "src": "00000029.jpg",
        "n": "27a",
        "o": "r"
    },
    {
        "src": "00000030.jpg",
        "n": "28a",
        "o": "v"
    },
    {
        "src": "00000031.jpg",
        "n": "29a",
        "o": "r"
    },
    {
        "src": "00000032.jpg",
        "n": "30a",
        "o": "v"
    },
    {
        "src": "00000033.jpg",
        "n": "31a",
        "o": "r"
    },
    {
        "src": "00000034.jpg",
        "n": "32a",
        "o": "v"
    },
    {
        "src": "00000035.jpg",
        "n": "33a",
        "o": "r"
    },
    {
        "src": "00000036.jpg",
        "n": "34a",
        "o": "v"
    },
    {
        "src": "00000037.jpg",
        "n": "35a",
        "o": "r"
    },
    {
        "src": "00000038.jpg",
        "n": "36a",
        "o": "v"
    },
    {
        "src": "00000039.jpg",
        "n": "37a",
        "o": "r"
    },
    {
        "src": "00000040.jpg",
        "n": "38a",
        "o": "v"
    },
    {
        "src": "00000041.jpg",
        "n": "39a",
        "o": "r"
    },
    {
        "src": "00000042.jpg",
        "n": "40a",
        "o": "v"
    },
    {
        "src": "00000043.jpg",
        "n": "41a",
        "o": "r"
    },
    {
        "src": "00000044.jpg",
        "n": "42a",
        "o": "v"
    },
    {
        "src": "00000045.jpg",
        "n": "43a",
        "o": "r"
    },
    {
        "src": "00000046.jpg",
        "n": "44a",
        "o": "v"
    },
    {
        "src": "00000047.jpg",
        "n": "45a",
        "o": "r"
    },
    {
        "src": "00000048.jpg",
        "n": "46a",
        "o": "v"
    },
    {
        "src": "00000049.jpg",
        "n": "47a",
        "o": "r"
    },
    {
        "src": "00000050.jpg",
        "n": "48a",
        "o": "v"
    },
    {
        "src": "00000051.jpg",
        "n": "49a",
        "o": "r"
    },
    {
        "src": "00000052.jpg",
        "n": "50a",
        "o": "v"
    },
    {
        "src": "00000053.jpg",
        "n": "51a",
        "o": "r"
    },
    {
        "src": "00000054.jpg",
        "n": "52a",
        "o": "v"
    },
    {
        "src": "00000055.jpg",
        "n": "53a",
        "o": "r"
    },
    {
        "src": "00000056.jpg",
        "n": "54a",
        "o": "v"
    },
    {
        "src": "00000057.jpg",
        "n": "55a",
        "o": "r"
    },
    {
        "src": "00000058.jpg",
        "n": "56a",
        "o": "v"
    },
    {
        "src": "00000059.jpg",
        "n": "57a",
        "o": "r"
    },
    {
        "src": "00000060.jpg",
        "n": "58a",
        "o": "v"
    },
    {
        "src": "00000061.jpg",
        "n": "59a",
        "o": "r"
    },
    {
        "src": "00000062.jpg",
        "n": "60a",
        "o": "v"
    },
    {
        "src": "00000063.jpg",
        "n": "61a",
        "o": "r"
    },
    {
        "src": "00000064.jpg",
        "n": "62a",
        "o": "v"
    },
    {
        "src": "00000065.jpg",
        "n": "63a",
        "o": "r"
    },
    {
        "src": "00000066.jpg",
        "n": "64a",
        "o": "v"
    },
    {
        "src": "00000067.jpg",
        "n": "65a",
        "o": "r"
    },
    {
        "src": "00000068.jpg",
        "n": "66a",
        "o": "v"
    },
    {
        "src": "00000069.jpg",
        "n": "67a",
        "o": "r"
    },
    {
        "src": "00000070.jpg",
        "n": "68a",
        "o": "v"
    },
    {
        "src": "00000071.jpg",
        "n": "69a",
        "o": "r"
    },
    {
        "src": "00000072.jpg",
        "n": "70a",
        "o": "v"
    },
    {
        "src": "00000073.jpg",
        "n": "71a",
        "o": "r"
    },
    {
        "src": "00000074.jpg",
        "n": "72a",
        "o": "v"
    },
    {
        "src": "00000075.jpg",
        "n": "73a",
        "o": "r"
    },
    {
        "src": "00000076.jpg",
        "n": "74a",
        "o": "v"
    },
    {
        "src": "00000077.jpg",
        "n": "75a",
        "o": "r"
    },
    {
        "src": "00000078.jpg",
        "n": "76a",
        "o": "v"
    },
    {
        "src": "00000079.jpg",
        "n": "77a",
        "o": "r"
    },
    {
        "src": "00000080.jpg",
        "n": "78a",
        "o": "v"
    },
    {
        "src": "00000081.jpg",
        "n": "79a",
        "o": "r"
    },
    {
        "src": "00000082.jpg",
        "n": "80a",
        "o": "v"
    },
    {
        "src": "00000083.jpg",
        "n": "81a",
        "o": "r"
    },
    {
        "src": "00000084.jpg",
        "n": "82a",
        "o": "v"
    },
    {
        "src": "00000085.jpg",
        "n": "83a",
        "o": "r"
    },
    {
        "src": "00000086.jpg",
        "n": "84a",
        "o": "v"
    },
    {
        "src": "00000087.jpg",
        "n": "85a",
        "o": "r"
    },
    {
        "src": "00000088.jpg",
        "n": "86a",
        "o": "v"
    },
    {
        "src": "00000089.jpg",
        "n": "87a",
        "o": "r"
    },
    {
        "src": "00000090.jpg",
        "n": "88a",
        "o": "v"
    },
    {
        "src": "00000091.jpg",
        "n": "89a",
        "o": "r"
    },
    {
        "src": "00000092.jpg",
        "n": "90a",
        "o": "v"
    },
    {
        "src": "00000093.jpg",
        "n": "91a",
        "o": "r"
    },
    {
        "src": "00000094.jpg",
        "n": "92a",
        "o": "v"
    },
    {
        "src": "00000095.jpg",
        "n": "93a",
        "o": "r"
    },
    {
        "src": "00000096.jpg",
        "n": "94a",
        "o": "v"
    },
    {
        "src": "00000097.jpg",
        "n": "95a",
        "o": "r"
    },
    {
        "src": "00000098.jpg",
        "n": "96a",
        "o": "v"
    },
    {
        "src": "00000099.jpg",
        "n": "97a",
        "o": "r"
    },
    {
        "src": "00000100.jpg",
        "n": "98a",
        "o": "v"
    },
    {
        "src": "00000101.jpg",
        "n": "99a",
        "o": "r"
    },
    {
        "src": "00000102.jpg",
        "n": "100a",
        "o": "v"
    },
    {
        "src": "00000103.jpg",
        "n": "101a",
        "o": "r"
    },
    {
        "src": "00000104.jpg",
        "n": "102a",
        "o": "v"
    },
    {
        "src": "00000105.jpg",
        "n": "103a",
        "o": "r"
    },
    {
        "src": "00000106.jpg",
        "n": "104a",
        "o": "v"
    },
    {
        "src": "00000107.jpg",
        "n": "105a",
        "o": "r"
    },
    {
        "src": "00000108.jpg",
        "n": "106a",
        "o": "v"
    },
    {
        "src": "00000109.jpg",
        "n": "107a",
        "o": "r"
    },
    {
        "src": "00000110.jpg",
        "n": "108a",
        "o": "v"
    },
    {
        "src": "00000111.jpg",
        "n": "109a",
        "o": "r"
    },
    {
        "src": "00000112.jpg",
        "n": "110a",
        "o": "v"
    },
    {
        "src": "00000113.jpg",
        "n": "111a",
        "o": "r"
    },
    {
        "src": "00000114.jpg",
        "n": "112a",
        "o": "v"
    },
    {
        "src": "00000115.jpg",
        "n": "113a",
        "o": "r"
    },
    {
        "src": "00000116.jpg",
        "n": "114a",
        "o": "v"
    },
    {
        "src": "00000117.jpg",
        "n": "115a",
        "o": "r"
    },
    {
        "src": "00000118.jpg",
        "n": "116a",
        "o": "v"
    },
    {
        "src": "00000119.jpg",
        "n": "117a",
        "o": "r"
    },
    {
        "src": "00000120.jpg",
        "n": "118a",
        "o": "v"
    },
    {
        "src": "00000121.jpg",
        "n": "119a",
        "o": "r"
    },
    {
        "src": "00000122.jpg",
        "n": "120a",
        "o": "v"
    },
    {
        "src": "00000123.jpg",
        "n": "121a",
        "o": "r"
    },
    {
        "src": "00000124.jpg",
        "n": "122a",
        "o": "v"
    },
    {
        "src": "00000125.jpg",
        "n": "123a",
        "o": "r"
    },
    {
        "src": "00000126.jpg",
        "n": "124a",
        "o": "v"
    },
    {
        "src": "00000127.jpg",
        "n": "125a",
        "o": "r"
    },
    {
        "src": "00000128.jpg",
        "n": "126a",
        "o": "v"
    },
    {
        "src": "00000129.jpg",
        "n": "127a",
        "o": "r"
    },
    {
        "src": "00000130.jpg",
        "n": "128a",
        "o": "v"
    },
    {
        "src": "00000131.jpg",
        "n": "129a",
        "o": "r"
    },
    {
        "src": "00000132.jpg",
        "n": "130a",
        "o": "v"
    },
    {
        "src": "00000133.jpg",
        "n": "131a",
        "o": "r"
    },
    {
        "src": "00000134.jpg",
        "n": "132a",
        "o": "v"
    },
    {
        "src": "00000135.jpg",
        "n": "133a",
        "o": "r"
    },
    {
        "src": "00000136.jpg",
        "n": "134a",
        "o": "v"
    },
    {
        "src": "00000137.jpg",
        "n": "135a",
        "o": "r"
    },
    {
        "src": "00000138.jpg",
        "n": "136a",
        "o": "v"
    },
    {
        "src": "00000139.jpg",
        "n": "137a",
        "o": "r"
    },
    {
        "src": "00000140.jpg",
        "n": "138a",
        "o": "v"
    },
    {
        "src": "00000141.jpg",
        "n": "139a",
        "o": "r"
    },
    {
        "src": "00000142.jpg",
        "n": "138a-139a",
        "o": "c"
    },
    {
        "src": "00000143.jpg",
        "n": "138aa",
        "o": "v"
    },
    {
        "src": "00000144.jpg",
        "n": "139aa",
        "o": "r"
    },
    {
        "src": "00000145.jpg",
        "n": "140a",
        "o": "v"
    },
    {
        "src": "00000146.jpg",
        "n": "141a",
        "o": "r"
    },
    {
        "src": "00000147.jpg",
        "n": "142a",
        "o": "v"
    },
    {
        "src": "00000148.jpg",
        "n": "143a",
        "o": "r"
    },
    {
        "src": "00000149.jpg",
        "n": "144a",
        "o": "v"
    },
    {
        "src": "00000150.jpg",
        "n": "145a",
        "o": "r"
    },
    {
        "src": "00000151.jpg",
        "n": "146a",
        "o": "v"
    },
    {
        "src": "00000152.jpg",
        "n": "147a",
        "o": "r"
    },
    {
        "src": "00000153.jpg",
        "n": "148a",
        "o": "v"
    },
    {
        "src": "00000154.jpg",
        "n": "149a",
        "o": "r"
    },
    {
        "src": "00000155.jpg",
        "n": "150a",
        "o": "v"
    },
    {
        "src": "00000156.jpg",
        "n": "151a",
        "o": "r"
    },
    {
        "src": "00000157.jpg",
        "n": "152a",
        "o": "v"
    },
    {
        "src": "00000158.jpg",
        "n": "153a",
        "o": "r"
    },
    {
        "src": "00000159.jpg",
        "n": "154a",
        "o": "v"
    },
    {
        "src": "00000160.jpg",
        "n": "155a",
        "o": "r"
    },
    {
        "src": "00000161.jpg",
        "n": "156a",
        "o": "v"
    },
    {
        "src": "00000162.jpg",
        "n": "157a",
        "o": "r"
    },
    {
        "src": "00000163.jpg",
        "n": "158a",
        "o": "v"
    },
    {
        "src": "00000164.jpg",
        "n": "159a",
        "o": "r"
    },
    {
        "src": "00000165.jpg",
        "n": "160a",
        "o": "v"
    },
    {
        "src": "00000166.jpg",
        "n": "161a",
        "o": "r"
    },
    {
        "src": "00000167.jpg",
        "n": "162a",
        "o": "v"
    },
    {
        "src": "00000168.jpg",
        "n": "162aa",
        "o": "r"
    },
    {
        "src": "00000169.jpg",
        "n": "i",
        "o": "v"
    },
    {
        "src": "00000170.jpg",
        "n": "ii",
        "o": "r"
    },
    {
        "src": "00000171.jpg",
        "n": "iii",
        "o": "v"
    },
    {
        "src": "00000172.jpg",
        "n": "iv",
        "o": "r"
    },
    {
        "src": "00000173.jpg",
        "n": "v",
        "o": "v"
    },
    {
        "src": "00000174.jpg",
        "n": "1b",
        "o": "r"
    },
    {
        "src": "00000175.jpg",
        "n": "2b",
        "o": "v"
    },
    {
        "src": "00000176.jpg",
        "n": "3b",
        "o": "r"
    },
    {
        "src": "00000177.jpg",
        "n": "4b",
        "o": "v"
    },
    {
        "src": "00000178.jpg",
        "n": "5b",
        "o": "r"
    },
    {
        "src": "00000179.jpg",
        "n": "6b",
        "o": "v"
    },
    {
        "src": "00000180.jpg",
        "n": "7b",
        "o": "r"
    },
    {
        "src": "00000181.jpg",
        "n": "8b",
        "o": "v"
    },
    {
        "src": "00000182.jpg",
        "n": "9b",
        "o": "r"
    },
    {
        "src": "00000183.jpg",
        "n": "10b",
        "o": "v"
    },
    {
        "src": "00000184.jpg",
        "n": "11b",
        "o": "r"
    },
    {
        "src": "00000185.jpg",
        "n": "12b",
        "o": "v"
    },
    {
        "src": "00000186.jpg",
        "n": "13b",
        "o": "r"
    },
    {
        "src": "00000187.jpg",
        "n": "14b",
        "o": "v"
    },
    {
        "src": "00000188.jpg",
        "n": "15b",
        "o": "r"
    },
    {
        "src": "00000189.jpg",
        "n": "16b",
        "o": "v"
    },
    {
        "src": "00000190.jpg",
        "n": "17b",
        "o": "r"
    },
    {
        "src": "00000191.jpg",
        "n": "18b",
        "o": "v"
    },
    {
        "src": "00000192.jpg",
        "n": "19b",
        "o": "r"
    },
    {
        "src": "00000193.jpg",
        "n": "20b",
        "o": "v"
    },
    {
        "src": "00000194.jpg",
        "n": "21b",
        "o": "r"
    },
    {
        "src": "00000195.jpg",
        "n": "22b",
        "o": "v"
    },
    {
        "src": "00000196.jpg",
        "n": "23b",
        "o": "r"
    },
    {
        "src": "00000197.jpg",
        "n": "24b",
        "o": "v"
    },
    {
        "src": "00000198.jpg",
        "n": "25b",
        "o": "r"
    },
    {
        "src": "00000199.jpg",
        "n": "26b",
        "o": "v"
    },
    {
        "src": "00000200.jpg",
        "n": "27b",
        "o": "r"
    },
    {
        "src": "00000201.jpg",
        "n": "28b",
        "o": "v"
    },
    {
        "src": "00000202.jpg",
        "n": "29b",
        "o": "r"
    },
    {
        "src": "00000203.jpg",
        "n": "30b",
        "o": "v"
    },
    {
        "src": "00000204.jpg",
        "n": "31b",
        "o": "r"
    },
    {
        "src": "00000205.jpg",
        "n": "32b",
        "o": "v"
    },
    {
        "src": "00000206.jpg",
        "n": "33b",
        "o": "r"
    },
    {
        "src": "00000207.jpg",
        "n": "34b",
        "o": "v"
    },
    {
        "src": "00000208.jpg",
        "n": "35b",
        "o": "r"
    },
    {
        "src": "00000209.jpg",
        "n": "36b",
        "o": "v"
    },
    {
        "src": "00000210.jpg",
        "n": "37b",
        "o": "r"
    },
    {
        "src": "00000211.jpg",
        "n": "38b",
        "o": "v"
    },
    {
        "src": "00000212.jpg",
        "n": "39b",
        "o": "r"
    },
    {
        "src": "00000213.jpg",
        "n": "40b",
        "o": "v"
    },
    {
        "src": "00000214.jpg",
        "n": "41b",
        "o": "r"
    },
    {
        "src": "00000215.jpg",
        "n": "42b",
        "o": "v"
    },
    {
        "src": "00000216.jpg",
        "n": "43b",
        "o": "r"
    },
    {
        "src": "00000217.jpg",
        "n": "44b",
        "o": "v"
    },
    {
        "src": "00000218.jpg",
        "n": "45b",
        "o": "r"
    },
    {
        "src": "00000219.jpg",
        "n": "46b",
        "o": "v"
    },
    {
        "src": "00000220.jpg",
        "n": "47b",
        "o": "r"
    },
    {
        "src": "00000221.jpg",
        "n": "48b",
        "o": "v"
    },
    {
        "src": "00000222.jpg",
        "n": "49b",
        "o": "r"
    },
    {
        "src": "00000223.jpg",
        "n": "50b",
        "o": "v"
    },
    {
        "src": "00000224.jpg",
        "n": "51b",
        "o": "r"
    },
    {
        "src": "00000225.jpg",
        "n": "52b",
        "o": "v"
    },
    {
        "src": "00000226.jpg",
        "n": "53b",
        "o": "r"
    },
    {
        "src": "00000227.jpg",
        "n": "54b",
        "o": "v"
    },
    {
        "src": "00000228.jpg",
        "n": "55b",
        "o": "r"
    },
    {
        "src": "00000229.jpg",
        "n": "56b",
        "o": "v"
    },
    {
        "src": "00000230.jpg",
        "n": "57b",
        "o": "r"
    },
    {
        "src": "00000231.jpg",
        "n": "58b",
        "o": "v"
    },
    {
        "src": "00000232.jpg",
        "n": "59b",
        "o": "r"
    },
    {
        "src": "00000233.jpg",
        "n": "60b",
        "o": "v"
    },
    {
        "src": "00000234.jpg",
        "n": "61b",
        "o": "r"
    },
    {
        "src": "00000235.jpg",
        "n": "62b",
        "o": "v"
    },
    {
        "src": "00000236.jpg",
        "n": "63b",
        "o": "r"
    },
    {
        "src": "00000237.jpg",
        "n": "64b",
        "o": "v"
    },
    {
        "src": "00000238.jpg",
        "n": "65b",
        "o": "r"
    },
    {
        "src": "00000239.jpg",
        "n": "66b",
        "o": "v"
    },
    {
        "src": "00000240.jpg",
        "n": "67b",
        "o": "r"
    },
    {
        "src": "00000241.jpg",
        "n": "68b",
        "o": "v"
    },
    {
        "src": "00000242.jpg",
        "n": "69b",
        "o": "r"
    },
    {
        "src": "00000243.jpg",
        "n": "70b",
        "o": "v"
    },
    {
        "src": "00000244.jpg",
        "n": "71b",
        "o": "r"
    },
    {
        "src": "00000245.jpg",
        "n": "72b",
        "o": "v"
    },
    {
        "src": "00000246.jpg",
        "n": "73b",
        "o": "r"
    },
    {
        "src": "00000247.jpg",
        "n": "74b",
        "o": "v"
    },
    {
        "src": "00000248.jpg",
        "n": "75b",
        "o": "r"
    },
    {
        "src": "00000249.jpg",
        "n": "76b",
        "o": "v"
    },
    {
        "src": "00000250.jpg",
        "n": "77b",
        "o": "r"
    },
    {
        "src": "00000251.jpg",
        "n": "78b",
        "o": "v"
    },
    {
        "src": "00000252.jpg",
        "n": "79b",
        "o": "r"
    }
];
/**
 * Get the actual dimenion value from a 123px value
 * @param d the parameter with "px" on the end
 * @return the dimention sans px as a number
 */
function dimen(d)
{
    var pos = d.indexOf("px");
    return parseInt(d.substr(0,pos));
}
/**
 * Get the index of the next recto page
 * @param start the current page index
 * @return the page index of the next recto (or centre) or the same if no more
 */
function nextR( start )
{
    if ( typeof start == "string" )
        start = parseInt(start);
    var i = start+1;
    for ( ;i<pages.length;i++ )
    {
        if ( pages[i].o=='r' || pages[i].o=='c' )
            break;
    }
    return (i>=pages.length)?start:i;
}
/**
 * Get the previous recto page
 * @param start the index of the current recto page 
 * @return the previous recto or centre aligned index
 */
function prevR( start )
{
    var i = (start==0)?0:start-1;
    for ( ;i>0;i-- )
        if ( pages[i].o=='r' || pages[i].o=='c' )
            break;
    return (i<0)?start:i;
}
/**
 * Get the javascript object of the preceding left page
 * @param page the recto or centre aligned page index
 * @return the page object of the corresponding verso or null
 */

function leftPage( page )
{
    if ( pages[page].o=='c' )
        return null;
    else
    {
        page--;
        if ( page >= 0 )
        {
            if ( pages[page].o == 'c' )
                return null;
            else
                return pages[page];
        }
        else 
            return null;
    }
}
/**
 * Set the image height and width
 * @param jImg the jQuery image object
 * @param maxW its maximum width
 * @param maxH its maximum height
 */
function setImageWidth( jImg, maxW, maxH )
{
    var h = jImg[0].height;
    var w = jImg[0].width;
    var scaledW = (maxH/h)*w;
    var scaledH = (maxW/w)*h;
    var realW = scaledW;
    var realH = maxH;
    if ( scaledW > maxW )
    {
        realW = maxW;
        realH = scaledH;
    }
    jImg.height(realH);
    return realW;
}
/**
 * Draw either side or the centre aligned image aleady set
 * @param side the side to redraw
 */
function redraw( side )
{
    var vmargin = dimen($("body").css("margin-top"))
        +dimen($("body").css("margin-bottom"))
        +dimen($("#ms-left").css("border-top-width"))
        +dimen($("#ms-left").css("border-bottom-width"))
        +$("#ms-slider").height();
    var maxH = Math.max($(window).height(),window.innerHeight)-vmargin;
    var maxW = Math.max($("#ms-left img").width(),$("#ms-right img").width())*2;
    maxW = maxW/2;
    switch ( side )
    {
        case 'v':
            setImageWidth($("#ms-left img"),maxW,maxH);
            break;
        case 'r':
            setImageWidth($("#ms-right img"),maxW,maxH);
            break;
        case 'c':
            setImageWidth($("#ms-centre img"),maxW*2,maxH);
            break;
    }
}
function loadImage( jImg, side )
{
    if ( jImg[0].complete )
    {
        jImg.hide();
        console.log("width="+jImg.width());
        redraw(side);
        jImg.fadeIn(250);
    }
    else
        window.setTimeout(loadImage,10,jImg,side);
}
/**
 * Draw both lhs and rhs images
 */
function drawImgs(leftPage,rightPage) 
{
    if ( leftPage != null )
    {
        if ( $("#ms-left").css("display") == 'none' )
            $("#ms-left").css("display","table-cell");
        $("#ms-left img").attr("src","B78/"+leftPage.src);
        loadImage( $("#ms-left img"), 'v' );
        $("#ms-page-left").text(leftPage.n);
        if ( rightPage != null )
            $("#ms-centre").css("display","none");
    }
    else
    { 
         $("#ms-left img").removeAttr("src");
         $("#ms-left img").hide();
         $("#ms-page-left").text("");
    }
    if ( rightPage != null )
    {
        if ( rightPage.o=='c' )
        {
            $("#ms-centre img").attr("src","B78/"+rightPage.src);
            loadImage( $("#ms-centre img"), 'c' );
            if ( $("#ms-centre").css("display") == 'none' )
                $("#ms-centre").css("display","table-cell");
            $("#ms-left").css("display","none");
            $("#ms-right").css("display","none");
            $("#ms-page-right").text(rightPage.n);
        }
        else
        {
            if ( $("#ms-right").css("display") == 'none' )
                $("#ms-right").css("display","table-cell");
            if ( $("#ms-centre").css("display") == 'table-cell' )
                $("#ms-centre").css("display","none");
            $("#ms-right img").attr("src","B78/"+rightPage.src);
            console.log("loading "+rightPage.src);
            loadImage( $("#ms-right img"),'r');
            $("#ms-page-right").text(rightPage.n);
        }
    }
    else
        $("#ms-right img").removeAttr("src");
}
function checkRecto( page )
{
    if ( pages[page].o == 'r'||pages[page].o =='c' )
        return page;
    else 
    {
        var i=page;
        for ( ;i<pages.length;i++ )
        {
            if ( pages[i].o=='r' || pages[i].o=='c' )
                break;
        }
        if ( i == page || i == pages.length )
        {
            i = page;
            for ( ;i>=0;i-- )
                if ( pages[i].o=='r' || pages[i].o=='c' )
                    break;
            if ( i==-1||pages[i].o == 'v' )
                return 0;
        }
        return i;
    }
}
$(document).ready(function(){
    $("#ms-slider").slider(
    {
        min:0,
        max:pages.length-1,
        slide:function(){
            var value = $("#ms-slider").slider("value");
            currPage = checkRecto(value);
            var leftPg = leftPage(currPage);
            var rightPg = pages[currPage];
            drawImgs(leftPg,rightPg);
        }
    });
    currPage = (pages[0].o=='r')?0:nextR(0);
    drawImgs(leftPage(currPage),pages[currPage]);
    $("#go-left").click( function(){
        currPage = prevR(currPage);
        $("#ms-slider").slider("value",currPage);
        var leftPg = leftPage(currPage);
        var rightPg = pages[currPage];
        drawImgs(leftPg,rightPg);
    });
    $("#go-right").click(function(){
        currPage = nextR(currPage);
        $("#ms-slider").slider("value",currPage);
        var rightPg = pages[currPage];
        var leftPg = leftPage(currPage);
        drawImgs(leftPg,rightPg);
    });
}); 
